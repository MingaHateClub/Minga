(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{"3t9w":function(e,t,n){"use strict";n.r(t),n.d(t,"StudentIdOverlayRoutesModule",(function(){return L}));var i=n("8Y7J"),s=n("iInd"),o=n("mrSG"),r=n("XNiG"),a=n("PqYM"),d=n("itXk"),c=n("1G5W"),l=n("lJxs"),u=n("w1tV"),h=n("PLeU"),p=n("Cnb3"),g=n("OgRi"),f=n("/YXT"),I=n("fLL5"),v=n("3qIc"),m=n("BxgO"),y=n("SVse"),C=n("uplL"),S=n("u3Fk"),O=n("Fudl");function P(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",8),i["\u0275\u0275pipe"](1,"async"),i["\u0275\u0275text"](2),i["\u0275\u0275pipe"](3,"date"),i["\u0275\u0275pipe"](4,"async"),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"](2);i["\u0275\u0275styleProp"]("font-size",i["\u0275\u0275pipeBind1"](1,3,e.idClockFontSize$),"rem"),i["\u0275\u0275advance"](2),i["\u0275\u0275textInterpolate1"](" ",i["\u0275\u0275pipeBind2"](3,5,i["\u0275\u0275pipeBind1"](4,8,e.currentDate$),"HH:mm:ss")," ")}}function b(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"div",null,3),i["\u0275\u0275elementStart"](2,"mg-overlay-nav-item",4),i["\u0275\u0275listener"]("click",(function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().onOverlayClose()})),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementStart"](3,"mg-overlay-nav-item",5),i["\u0275\u0275template"](4,P,5,10,"div",6),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementStart"](5,"mg-overlay-nav-item",7),i["\u0275\u0275listener"]("click",(function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().gotoSuicidePreventionHotline()})),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"](),t=i["\u0275\u0275reference"](4);i["\u0275\u0275classProp"]("offline-indicator",e.isOffline),i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("ngIf",!e.isOffline)("ngIfElse",t)}}function _(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"mg-student-id-view",9),i["\u0275\u0275listener"]("idPhotoChange",(function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().idPhotoChange()}))("uploadStudentIdPhotoChange",(function(t){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().uploadStudentIdPhotoChange(t)})),i["\u0275\u0275pipe"](1,"async"),i["\u0275\u0275pipe"](2,"async"),i["\u0275\u0275elementEnd"]()}if(2&e){const e=t.ngIf,n=i["\u0275\u0275nextContext"]();i["\u0275\u0275property"]("studentIdInfo",n.studentIdInfo)("studentIdMingaSettings",e)("studentIdImageAsset",n.studentIdImage)("activeHallPasses",i["\u0275\u0275pipeBind1"](1,7,n.activeHallPassesForPerson$))("openPrintPreview",n.openPrintPreview)("canUseCustomColorsByGrade",i["\u0275\u0275pipeBind1"](2,9,n.canUseCustomColorsByGrade$))("displayIdNum",n.displayIdNum)}}function j(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",10),i["\u0275\u0275elementStart"](1,"mg-icon",11),i["\u0275\u0275text"](2,"offline"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementStart"](3,"div",12),i["\u0275\u0275text"](4,"OFFLINE"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"]())}let w=(()=>{class e{constructor(e,t,n,i,s,o,d){this.router=e,this.route=t,this.studentIdService=n,this._cdr=i,this.idUploaderDialog=s,this._hpService=o,this._settingService=d,this.personHash="",this.icons=[],this.studentIdImage="",this.openPrintPreview=!1,this.displayIdNum=!0,this.isOffline=!1,this._destroyed$=new r.a,this.studentIdService.resetAllowPrint();const h=p.mingaSettingTypes;this._routeParamSub=t.params.pipe(Object(c.a)(this._destroyed$)).subscribe(e=>{e.id&&(this.personHash=e.id),e.print&&(this.openPrintPreview=!0)}),this._hpService.hallPassDidEnd$.pipe(Object(c.a)(this._destroyed$)).subscribe(()=>{this.fetchCurrentUsersActiveHallPasses()}),this.fetchCurrentUsersActiveHallPasses(),this.studentIdMingaSettings$=this.studentIdService.idSettings$,this.initDisplayIdNum(),this.currentDate$=Object(a.a)(0,1e3).pipe(Object(l.a)(()=>new Date),Object(u.a)()),this.canUseCustomColorsByGrade$=this._settingService.getSettingValueObs(h.ID_ENABLE_GRADE_COLORS),this.idClockFontSize$=this._settingService.getSettingValueObs(h.ID_CLOCK_FONT_SIZE).pipe(Object(l.a)(e=>1+e/100))}ngOnInit(){this.personHash?this.initPersonStudentIdInfo(this.personHash):this.initCurrentPersonStudentIdInfo()}initDisplayIdNum(){return Object(o.a)(this,void 0,void 0,(function*(){this.displayIdNum=yield this.studentIdService.checkDisplayId(this.personHash),this._cdr.markForCheck()}))}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}initCurrentPersonStudentIdInfo(){return Object(o.a)(this,void 0,void 0,(function*(){Object(d.b)(this.studentIdService.studentId$.asObservable(),this.studentIdService.studentIdImages$.asObservable()).pipe(Object(c.a)(this._destroyed$)).subscribe(([e,t])=>{e&&(this.personHash=e.personHash,this.initDisplayIdNum(),e.image=t.image,e.icons=t.icons,e.noAccess=t.noAccess,this.studentIdInfo=Object.assign({},e),this.isOffline=e.isOffline,this._cdr.markForCheck())});try{yield this.studentIdService.read()}catch(e){console.error(e.message),this.isOffline=this.studentIdService.isStudentIdOffline()}}))}initPersonStudentIdInfo(e){return Object(o.a)(this,void 0,void 0,(function*(){try{Object(d.b)(this.studentIdService.studentId$.asObservable(),this.studentIdService.studentIdImages$.asObservable()).pipe(Object(c.a)(this._destroyed$)).subscribe(([e,t])=>{e.image=t.image,e.icons=t.icons,e.noAccess=t.noAccess,this.studentIdInfo=Object.assign({},e),this._cdr.markForCheck()}),this.studentIdService.read(e)}catch(t){console.error(t.message)}}))}onOverlayClose(){Object(h.a)(this.router)}gotoSuicidePreventionHotline(){Object(h.a)(this.router).then(()=>{this.router.navigate(["",{outlets:{o:["suicidepreventionhotline"]}}])})}idPhotoChange(){this.studentIdInfo&&this.idUploaderDialog.open({data:{personHash:this.personHash,currentImage:this.studentIdInfo.image}}).afterClosed().subscribe(e=>Object(o.a)(this,void 0,void 0,(function*(){e&&(yield this.uploadStudentIdPhotoChange(e.fileName),e.previewUrl&&this.studentIdInfo&&(this.studentIdImage=e.previewUrl),this._cdr.markForCheck())})))}uploadStudentIdPhotoChange(e){return Object(o.a)(this,void 0,void 0,(function*(){e?yield this.studentIdService.updateImage(e):yield this.studentIdService.deleteStudentIdImage(this.personHash);try{yield this.studentIdService.read()}catch(t){console.error(t.message)}}))}fetchCurrentUsersActiveHallPasses(){this.activeHallPassesForPerson$=this._hpService.getHallPassesForRecipient(this.personHash)}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](s.g),i["\u0275\u0275directiveInject"](s.a),i["\u0275\u0275directiveInject"](g.a),i["\u0275\u0275directiveInject"](i.ChangeDetectorRef),i["\u0275\u0275directiveInject"](f.b),i["\u0275\u0275directiveInject"](I.a),i["\u0275\u0275directiveInject"](v.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["mg-student-id-personal-overlay"]],decls:5,vars:5,consts:[[3,"offline-indicator",4,"mgOverlayStructure","mgOverlayStructureRegion"],[3,"studentIdInfo","studentIdMingaSettings","studentIdImageAsset","activeHallPasses","openPrintPreview","canUseCustomColorsByGrade","displayIdNum","idPhotoChange","uploadStudentIdPhotoChange",4,"ngIf"],["offlineMode",""],["overlayNavTop",""],["icon","close",1,"mg-align-left",3,"click"],[1,"center-nav","mg-bodycopy-bold"],["class","center-nav-live-clock",3,"font-size",4,"ngIf","ngIfElse"],["icon","phone-o",1,"mg-align-right",3,"click"],[1,"center-nav-live-clock"],[3,"studentIdInfo","studentIdMingaSettings","studentIdImageAsset","activeHallPasses","openPrintPreview","canUseCustomColorsByGrade","displayIdNum","idPhotoChange","uploadStudentIdPhotoChange"],[1,"center-nav-offline"],[1,"center-nav-offline-icon"],[1,"center-nav-offline-heading"]],template:function(e,t){1&e&&(i["\u0275\u0275template"](0,b,6,4,"div",0),i["\u0275\u0275template"](1,_,3,11,"mg-student-id-view",1),i["\u0275\u0275pipe"](2,"async"),i["\u0275\u0275template"](3,j,5,0,"ng-template",null,2,i["\u0275\u0275templateRefExtractor"])),2&e&&(i["\u0275\u0275property"]("mgOverlayStructure",!0)("mgOverlayStructureRegion","top"),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",t.studentIdInfo&&i["\u0275\u0275pipeBind1"](2,3,t.studentIdMingaSettings$)))},directives:[m.a,y.o,C.a,S.a,O.a],pipes:[y.b,y.f],styles:["[_nghost-%COMP%]{display:block}.center-nav[_ngcontent-%COMP%]{justify-content:center;align-items:center}.center-nav-live-clock[_ngcontent-%COMP%]{line-height:1}.center-nav-offline[_ngcontent-%COMP%]{display:flex;color:#fff}.center-nav-offline-icon[_ngcontent-%COMP%]{margin-right:8px}.center-nav-offline-heading[_ngcontent-%COMP%]{line-height:24px}@media print{mg-overlay-nav-item[_ngcontent-%COMP%]{display:none!important}}.offline-indicator[_ngcontent-%COMP%]{background-color:#b75130}.offline-indicator[_ngcontent-%COMP%]   .mg-align-left[_ngcontent-%COMP%], .offline-indicator[_ngcontent-%COMP%]   .mg-align-right[_ngcontent-%COMP%]{color:#fff}"],changeDetection:0}),e})();var k=n("s7LF"),x=n("CO6v"),H=n("p+4T"),$=n("ugqS"),M=n("LJN2"),E=n("gU2t"),N=n("ls3q"),D=n("CL15"),F=n("Ogcz"),U=n("iQHv");let A=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=i["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=i["\u0275\u0275defineInjector"]({imports:[[H.a,D.a,N.a,x.a,E.a,$.a,F.b,U.a,M.a,k.m,y.c]]}),e})();const B=[{path:":id/:print",component:w},{path:":id",component:w},{path:"",component:w}];let L=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=i["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=i["\u0275\u0275defineInjector"]({imports:[[A,s.k.forChild(B)]]}),e})()}}]);
//# sourceMappingURL=minga-app-src-app-overlays-student-id-overlay-student-id-overlay-routes-module-es2015.js.map