(window.webpackJsonp=window.webpackJsonp||[]).push([[83],{"Gk8+":function(e,t,n){"use strict";n.r(t),n.d(t,"UserPreferencesRoutesModule",(function(){return ce}));var r=n("8Y7J"),a=n("iInd"),s=n("5m4e"),i=n("mrSG"),o=n("5km/"),c=n("lJxs"),l=n("5I2t"),u=n("KUBD"),d=n("2Vo4"),p=n("itXk"),f=n("pLZG"),g=n("tqRt"),m=n("6BHC");let h=(()=>{class e{constructor(e,t){this.store=e,this.userPreferencesProto=t,this._userPreferencesMetadata$=new d.a([]),this._userPreferencesValues$=new d.a({});const n=Object(p.b)(this._userPreferencesMetadata$,this._userPreferencesValues$);this.userPreferences$=n.pipe(Object(f.a)(([e])=>e.length>0),Object(c.a)(([e,t])=>{const n=[];for(const r of e){const e=r.getId();void 0!==t[e]&&n.push({id:e,name:r.getName(),description:r.getDescription(),value:t[e],category:r.getCategory()})}return n}))}fetch(){return Object(i.a)(this,void 0,void 0,(function*(){yield Promise.all([this.fetchMetadata(),this.fetchPreferencesIfNeeded()])}))}fetchIfNeeded(){return Object(i.a)(this,void 0,void 0,(function*(){yield Promise.all([this.fetchMetadataIfNeeded(),this.fetchPreferencesIfNeeded()])}))}updatePreference(e,t){return Object(i.a)(this,void 0,void 0,(function*(){const n=new u.UserPreferencesUpdateRequest;n.setId(e);const r=new u.UserPreferenceValue;"string"==typeof t?r.setStringValue(t):"boolean"==typeof t&&r.setBoolValue(t),n.setValue(r);const a=this.getPreferencesValue(e);this.setUserPreferencesValue(e,t);const s=(yield this.userPreferencesProto.update(n).catch(t=>{throw this.setUserPreferencesValue(e,a),t})).getUpdatedUserPreferences();this.triggerLocalUpdates(e,s.getIdValuesMap().get(e)||null),this.setUserPreferenceValuesFromMessage(s)}))}resetPreferences(){return Object(i.a)(this,void 0,void 0,(function*(){const e=new u.UserPreferencesResetRequest,t=(yield this.userPreferencesProto.reset(e)).getResettedUserPreferences();this.setUserPreferenceValuesFromMessage(t)}))}getPreferencesValue(e){return this._userPreferencesValues$.getValue()[e]}setUserPreferencesValue(e,t){const n=this._userPreferencesValues$.getValue();n[e]=t,this._userPreferencesValues$.next(n)}setUserPreferenceValuesFromMessage(e){const t=this._userPreferencesValues$.getValue();e.getIdValuesMap().forEach((e,n)=>{e.hasBoolValue()?t[n]=e.getBoolValue():e.hasStringValue()&&(t[n]=e.getStringValue())}),this._userPreferencesValues$.next(t)}fetchPreferencesIfNeeded(){return Object(i.a)(this,void 0,void 0,(function*(){0===Object.keys(this._userPreferencesValues$.getValue()).length&&(yield this.fetchPreferences())}))}fetchPreferences(){return Object(i.a)(this,void 0,void 0,(function*(){const e=new u.UserPreferencesGetRequest,t=(yield this.userPreferencesProto.get(e)).getUserPreferences();this.setUserPreferenceValuesFromMessage(t)}))}fetchMetadataIfNeeded(){return Object(i.a)(this,void 0,void 0,(function*(){0===this._userPreferencesMetadata$.getValue().length&&(yield this.fetchMetadata())}))}fetchMetadata(){return Object(i.a)(this,void 0,void 0,(function*(){const e=new u.UserPreferencesMetadataRequest,t=yield this.userPreferencesProto.metadata(e);this._userPreferencesMetadata$.next(t.getMetadataList())}))}triggerLocalUpdates(e,t){t?"directMessaging"===e&&t.hasBoolValue()&&this.store.dispatch(Object(l.q)({dmPersonalPreference:t.getBoolValue()})):console.warn("Invalid triggerLocalUpdates value for key",e)}}return e.\u0275fac=function(t){return new(t||e)(r["\u0275\u0275inject"](g.i),r["\u0275\u0275inject"](m.UserPreferences))},e.\u0275prov=r["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var v=n("GFah"),y=n("JF7H"),P=n("zc8W"),x=n("3qIc"),b=n("iELJ"),I=n("UWMR"),V=n("Fudl"),w=n("SVse"),S=n("o4Yh"),j=n("MAbt"),C=n("SFBQ"),M=n("VDRc"),k=n("jMqV"),E=n("Q2Ze"),O=n("i1AJ"),F=n("e6WT"),U=n("s7LF");const $=["*"];function B(e,t){if(1&e){const e=r["\u0275\u0275getCurrentView"]();r["\u0275\u0275elementStart"](0,"div",2),r["\u0275\u0275elementStart"](1,"div",3),r["\u0275\u0275projection"](2),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](3,"mat-slide-toggle",4),r["\u0275\u0275listener"]("change",(function(t){return r["\u0275\u0275restoreView"](e),r["\u0275\u0275nextContext"]().valueChange.emit(t.checked)})),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"]()}if(2&e){const e=r["\u0275\u0275nextContext"]();r["\u0275\u0275advance"](3),r["\u0275\u0275property"]("checked",e.value)}}const _=function(){return{standalone:!0}};function L(e,t){if(1&e){const e=r["\u0275\u0275getCurrentView"]();r["\u0275\u0275elementStart"](0,"mat-form-field",5),r["\u0275\u0275elementStart"](1,"mat-label"),r["\u0275\u0275projection"](2,1),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](3,"input",6),r["\u0275\u0275listener"]("ngModelChange",(function(t){return r["\u0275\u0275restoreView"](e),r["\u0275\u0275nextContext"]().valueChange.emit(t)})),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"]()}if(2&e){const e=r["\u0275\u0275nextContext"]();r["\u0275\u0275advance"](3),r["\u0275\u0275property"]("ngModelOptions",r["\u0275\u0275pureFunction0"](2,_))("ngModel",e.value)}}const N=[[["mg-user-preference-input-label"]],[["mg-user-preference-input-label"]]],D=["mg-user-preference-input-label","mg-user-preference-input-label"];let R=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=r["\u0275\u0275defineComponent"]({type:e,selectors:[["mg-user-preference-input-label"]],ngContentSelectors:$,decls:1,vars:0,template:function(e,t){1&e&&(r["\u0275\u0275projectionDef"](),r["\u0275\u0275projection"](0))},encapsulation:2,changeDetection:0}),e})(),T=(()=>{class e{constructor(){this.value=null,this.valueChange=new r.EventEmitter}isBool(){return"boolean"==typeof this.value}isString(){return"string"==typeof this.value}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=r["\u0275\u0275defineComponent"]({type:e,selectors:[["mg-user-preference-input"]],inputs:{value:"value"},outputs:{valueChange:"valueChange"},ngContentSelectors:D,decls:2,vars:2,consts:[["fxLayout","row","fxLayoutGap","8px","class","pref-input-wrap",4,"ngIf"],["mgFormField","",4,"ngIf"],["fxLayout","row","fxLayoutGap","8px",1,"pref-input-wrap"],["fxFlex","auto",1,"checkbox-label"],[1,"no-mg",3,"checked","change"],["mgFormField",""],["matInput","","type","text",3,"ngModelOptions","ngModel","ngModelChange"]],template:function(e,t){1&e&&(r["\u0275\u0275projectionDef"](N),r["\u0275\u0275template"](0,B,4,1,"div",0),r["\u0275\u0275template"](1,L,4,3,"mat-form-field",1)),2&e&&(r["\u0275\u0275property"]("ngIf",t.isBool()),r["\u0275\u0275advance"](1),r["\u0275\u0275property"]("ngIf",t.isString()))},directives:[w.o,M.e,M.f,M.b,k.a,E.d,O.a,E.h,F.b,U.d,U.t,U.w],styles:[".pref-input-wrap[_ngcontent-%COMP%]{align-items:center}"],changeDetection:0}),e})();var q=n("FlXp"),A=n("UO+7");function G(e,t){if(1&e&&(r["\u0275\u0275elementStart"](0,"div",11),r["\u0275\u0275text"](1),r["\u0275\u0275elementEnd"]()),2&e){const e=t.ngIf;r["\u0275\u0275advance"](1),r["\u0275\u0275textInterpolate1"](" ",e," ")}}function J(e,t){if(1&e&&r["\u0275\u0275element"](0,"mg-tooltip",15),2&e){const e=r["\u0275\u0275nextContext"]().$implicit;r["\u0275\u0275property"]("label",e.description)}}function W(e,t){if(1&e){const e=r["\u0275\u0275getCurrentView"]();r["\u0275\u0275elementStart"](0,"mg-user-preference-input",13),r["\u0275\u0275listener"]("valueChange",(function(n){r["\u0275\u0275restoreView"](e);const a=t.$implicit;return r["\u0275\u0275nextContext"](2).preferenceValueChange(a,n)})),r["\u0275\u0275elementStart"](1,"mg-user-preference-input-label"),r["\u0275\u0275text"](2),r["\u0275\u0275template"](3,J,1,1,"mg-tooltip",14),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"]()}if(2&e){const e=t.$implicit;r["\u0275\u0275property"]("value",e.value),r["\u0275\u0275advance"](2),r["\u0275\u0275textInterpolate1"](" ",e.name," "),r["\u0275\u0275advance"](1),r["\u0275\u0275property"]("ngIf",e.description)}}function H(e,t){if(1&e&&(r["\u0275\u0275elementStart"](0,"div",5),r["\u0275\u0275elementStart"](1,"mat-expansion-panel",6),r["\u0275\u0275elementStart"](2,"mat-expansion-panel-header"),r["\u0275\u0275elementStart"](3,"mat-panel-title",7),r["\u0275\u0275elementStart"](4,"strong"),r["\u0275\u0275text"](5),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275template"](6,W,4,3,"mg-user-preference-input",12),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit,n=r["\u0275\u0275nextContext"]();r["\u0275\u0275advance"](5),r["\u0275\u0275textInterpolate"](e.category),r["\u0275\u0275advance"](1),r["\u0275\u0275property"]("ngForOf",e.preferences)("ngForTrackBy",n.preferenceTrackBy)}}function K(e,t){if(1&e){const e=r["\u0275\u0275getCurrentView"]();r["\u0275\u0275elementStart"](0,"a",16),r["\u0275\u0275listener"]("click",(function(){return r["\u0275\u0275restoreView"](e),r["\u0275\u0275nextContext"]().unlinkAccounts()})),r["\u0275\u0275text"](1,"Unlink all your accounts"),r["\u0275\u0275elementEnd"]()}}function Q(e,t){1&e&&r["\u0275\u0275element"](0,"mg-default-parent-group-picker")}let X=(()=>{class e{constructor(e,t,n,r,a,s,i){this.userPreferences=e,this.rootService=t,this.authService=n,this.authInfo=r,this.dialog=s,this.snackBar=i,this.person$=this.authInfo.authPerson$,this.ssoInfo$=this.authInfo.linkedSsoProviderInfo$,this.groupTrackBy=(e,t)=>t.category,this.preferenceTrackBy=(e,t)=>t.id,this.districtFeatureEnabled$=a.observeDistrictFeatureEnabled(),this.groupedUserPreferences$=e.userPreferences$.pipe(Object(c.a)(e=>{const t=[],n=new Map;for(const r of e){const e=n.get(r.category);e?(e.push(r),n.set(r.category,e)):n.set(r.category,[r])}return n.forEach((e,n)=>{t.push({category:n,preferences:e})}),t}))}ngOnInit(){this.rootService.addLoadingPromise(this.userPreferences.fetchIfNeeded())}_updatePreference(e,t){return Object(i.a)(this,void 0,void 0,(function*(){yield this.userPreferences.updatePreference(e.id,t)}))}preferenceValueChange(e,t){this._updatePreference(e,t)}unlinkAccounts(){return Object(i.a)(this,void 0,void 0,(function*(){(yield this.authService.unlinkAllAccounts())?this.dialog.open(o.k,{data:{text:"Successfully unlinked your accounts"}}):this.snackBar.open("Oops! We had an issue unlinking your account. Please try again later.")}))}}return e.\u0275fac=function(t){return new(t||e)(r["\u0275\u0275directiveInject"](h),r["\u0275\u0275directiveInject"](v.a),r["\u0275\u0275directiveInject"](y.a),r["\u0275\u0275directiveInject"](P.a),r["\u0275\u0275directiveInject"](x.b),r["\u0275\u0275directiveInject"](b.b),r["\u0275\u0275directiveInject"](I.b))},e.\u0275cmp=r["\u0275\u0275defineComponent"]({type:e,selectors:[["ng-component"]],decls:26,vars:13,consts:[[1,"mg-headline","page-header"],[1,"default-icon"],[1,"card-container"],["class","mg-headline person-name",4,"ngIf"],["class","user-preference-input-wrap mg-minicopy",4,"ngFor","ngForOf","ngForTrackBy"],[1,"user-preference-input-wrap","mg-minicopy"],["mgExpansionPanel",""],[1,"mg-headline3"],[1,"small-user-content-page"],["href","javascript:;",3,"click",4,"ngIf"],[4,"ngIf"],[1,"mg-headline","person-name"],[3,"value","valueChange",4,"ngFor","ngForOf","ngForTrackBy"],[3,"value","valueChange"],[3,"label",4,"ngIf"],[3,"label"],["href","javascript:;",3,"click"]],template:function(e,t){if(1&e&&(r["\u0275\u0275elementStart"](0,"h1",0),r["\u0275\u0275elementStart"](1,"mg-icon",1),r["\u0275\u0275text"](2,"settings-o"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275text"](3," Preferences\n"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](4,"div",2),r["\u0275\u0275template"](5,G,2,1,"div",3),r["\u0275\u0275pipe"](6,"async"),r["\u0275\u0275template"](7,H,7,3,"div",4),r["\u0275\u0275pipe"](8,"async"),r["\u0275\u0275elementStart"](9,"div",5),r["\u0275\u0275elementStart"](10,"mat-expansion-panel",6),r["\u0275\u0275elementStart"](11,"mat-expansion-panel-header"),r["\u0275\u0275elementStart"](12,"mat-panel-title",7),r["\u0275\u0275elementStart"](13,"strong"),r["\u0275\u0275text"](14,"Connect"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](15,"div",8),r["\u0275\u0275elementStart"](16,"p"),r["\u0275\u0275elementStart"](17,"strong"),r["\u0275\u0275text"](18,"Connecting your Minga Account"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementStart"](19,"p"),r["\u0275\u0275text"](20," Keep it simple and secure. Login using one of these services so you don\u2019t have to use your password every time. "),r["\u0275\u0275elementEnd"](),r["\u0275\u0275element"](21,"mg-sso-ui"),r["\u0275\u0275template"](22,K,2,0,"a",9),r["\u0275\u0275pipe"](23,"async"),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275elementEnd"](),r["\u0275\u0275template"](24,Q,1,0,"mg-default-parent-group-picker",10),r["\u0275\u0275pipe"](25,"async")),2&e){let e=null;r["\u0275\u0275advance"](5),r["\u0275\u0275property"]("ngIf",null==(e=r["\u0275\u0275pipeBind1"](6,5,t.person$))?null:e.displayName),r["\u0275\u0275advance"](2),r["\u0275\u0275property"]("ngForOf",r["\u0275\u0275pipeBind1"](8,7,t.groupedUserPreferences$))("ngForTrackBy",t.groupTrackBy),r["\u0275\u0275advance"](15),r["\u0275\u0275property"]("ngIf",r["\u0275\u0275pipeBind1"](23,9,t.ssoInfo$)),r["\u0275\u0275advance"](2),r["\u0275\u0275property"]("ngIf",r["\u0275\u0275pipeBind1"](25,11,t.districtFeatureEnabled$))}},directives:[V.a,w.o,w.n,S.c,j.a,S.f,S.g,C.a,T,R,q.a,A.a],pipes:[w.b],styles:["[_nghost-%COMP%]{display:block;--feed-item-margin-side:16px}@media (min-width:600px){[_nghost-%COMP%]{--feed-item-margin-side:0}}h1[_ngcontent-%COMP%]{margin-left:var(--feed-item-margin-side);margin-right:var(--feed-item-margin-side)}.user-preference-input-wrap[_ngcontent-%COMP%]{margin:4px 12px;color:#737373}.card-container[_ngcontent-%COMP%]{display:block;overflow:hidden;border-radius:8px;background-color:#fff;box-shadow:0 0 6px rgba(0,0,0,.15);margin:12px var(--feed-item-margin-side,16px) var(--feed-item-margin-top,4px) var(--feed-item-margin-side,16px);text-align:left;max-width:510px;position:relative;padding:0;min-width:289px}.card-container[_ngcontent-%COMP%]   .person-name[_ngcontent-%COMP%]{border-bottom:1px solid #ccc;padding:16px 20px}"],changeDetection:0}),e})();var Y=n("fy1K"),Z=n("6Bu3"),z=n("0dDr"),ee=n("ls3q"),te=n("37Vl"),ne=n("u9T3"),re=n("HxU+");let ae=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=r["\u0275\u0275defineInjector"]({imports:[[re.a,w.c,U.m,F.c,E.f,k.b,ne.a]]}),e})(),se=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=r["\u0275\u0275defineInjector"]({imports:[[w.c]]}),e})(),ie=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=r["\u0275\u0275defineInjector"]({imports:[[se,ae,ee.a,Y.a,z.a,Z.a,te.a,w.c,S.b]]}),e})();const oe=[{path:"",component:X,canActivate:[s.a]}];let ce=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=r["\u0275\u0275defineInjector"]({imports:[[ie,a.k.forChild(oe)]]}),e})()}}]);
//# sourceMappingURL=minga-app-src-app-user-preferences-UserPreferencesRoutes-module-es2015.js.map