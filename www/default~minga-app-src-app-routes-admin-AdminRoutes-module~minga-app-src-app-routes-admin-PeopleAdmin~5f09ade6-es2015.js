(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"8Vb0":function(e,t,r){"use strict";r.d(t,"a",(function(){return j}));var o=r("8Y7J"),n=r("HHVM"),s=r("Ac3E"),a=r("jtHE"),i=r("1G5W"),l=r("JcrP"),c=r("YgQ7"),d=r("TxG7"),p=r("31iK"),g=r("yEy8"),h=r("3qIc"),u=r("SYVq"),f=r("s7LF"),m=r("T0RT"),x=r("SVse"),b=r("VDRc"),y=r("4avL"),v=r("BTe0"),k=r("ura0"),S=r("Fudl"),E=r("5QHs"),w=r("cRkC");const C=["form"],F=["paginator"],I=["successOverlayTemplate"];function P(e,t){if(1&e){const e=o["\u0275\u0275getCurrentView"]();o["\u0275\u0275elementStart"](0,"mg-button",16),o["\u0275\u0275listener"]("click",(function(){return o["\u0275\u0275restoreView"](e),o["\u0275\u0275nextContext"](2).clear()})),o["\u0275\u0275text"](1,"Clear"),o["\u0275\u0275elementEnd"]()}}const R=function(e){return{opacity:e}};function O(e,t){if(1&e){const e=o["\u0275\u0275getCurrentView"]();o["\u0275\u0275elementStart"](0,"div",12),o["\u0275\u0275elementStart"](1,"mg-button",13),o["\u0275\u0275listener"]("click",(function(){return o["\u0275\u0275restoreView"](e),o["\u0275\u0275nextContext"]().startUpload()})),o["\u0275\u0275text"](2),o["\u0275\u0275elementEnd"](),o["\u0275\u0275template"](3,P,2,0,"mg-button",14),o["\u0275\u0275element"](4,"mat-progress-bar",15),o["\u0275\u0275elementEnd"]()}if(2&e){const e=o["\u0275\u0275nextContext"]();o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("disabled",e.hasErrorsFromParse||e.uploading),o["\u0275\u0275advance"](1),o["\u0275\u0275textInterpolate1"]("Create (",e.blockorderUploadRecords.length,")"),o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("ngIf",!e.uploading),o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("ngStyle",o["\u0275\u0275pureFunction1"](6,R,e.uploading?"1":"0"))("value",e.totalProgress)("bufferValue",e.totalBufferProgress)}}function M(e,t){if(1&e){const e=o["\u0275\u0275getCurrentView"]();o["\u0275\u0275elementStart"](0,"div"),o["\u0275\u0275elementStart"](1,"div",17),o["\u0275\u0275listener"]("click",(function(){o["\u0275\u0275restoreView"](e);const r=t.$implicit;return o["\u0275\u0275nextContext"]().goToError(r.recordIndex)})),o["\u0275\u0275elementStart"](2,"mg-icon"),o["\u0275\u0275text"](3,"warning-o"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](4,"span",18),o["\u0275\u0275text"](5),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"]()}if(2&e){const e=t.$implicit;o["\u0275\u0275advance"](1),o["\u0275\u0275classProp"]("selectable",e.recordIndex>-1),o["\u0275\u0275advance"](4),o["\u0275\u0275textInterpolate"](e.errorMessage)}}const T=function(){return[5,10,25,100]};function L(e,t){if(1&e){const e=o["\u0275\u0275getCurrentView"]();o["\u0275\u0275elementStart"](0,"mat-paginator",19,20),o["\u0275\u0275listener"]("page",(function(t){return o["\u0275\u0275restoreView"](e),o["\u0275\u0275nextContext"]().onPageChange(t)})),o["\u0275\u0275elementEnd"]()}if(2&e){const e=o["\u0275\u0275nextContext"]();o["\u0275\u0275property"]("length",e.blockorderUploadRecords.length)("pageSize",e.defaultPageSize)("pageSizeOptions",o["\u0275\u0275pureFunction0"](3,T))}}function U(e,t){if(1&e&&(o["\u0275\u0275elementStart"](0,"div",27),o["\u0275\u0275elementStart"](1,"div",28),o["\u0275\u0275elementStart"](2,"mg-icon"),o["\u0275\u0275text"](3,"warning-o"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](4,"span",18),o["\u0275\u0275text"](5),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;o["\u0275\u0275advance"](5),o["\u0275\u0275textInterpolate"](e)}}function V(e,t){if(1&e){const e=o["\u0275\u0275getCurrentView"]();o["\u0275\u0275elementStart"](0,"mg-button",29),o["\u0275\u0275listener"]("click",(function(){o["\u0275\u0275restoreView"](e);const t=o["\u0275\u0275nextContext"]().index;return o["\u0275\u0275nextContext"]().removeRecord(t)})),o["\u0275\u0275elementStart"](1,"mg-icon",30),o["\u0275\u0275text"](2,"warning-o"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](3,"span",30),o["\u0275\u0275text"](4,"Remove"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"]()}}function _(e,t){if(1&e&&(o["\u0275\u0275elementStart"](0,"div",21),o["\u0275\u0275elementStart"](1,"div",22),o["\u0275\u0275elementStart"](2,"div"),o["\u0275\u0275text"](3),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](4,"div",23),o["\u0275\u0275elementStart"](5,"span"),o["\u0275\u0275text"](6,"on\xa0"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](7,"strong"),o["\u0275\u0275text"](8),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](9,"div",24),o["\u0275\u0275elementStart"](10,"div",18),o["\u0275\u0275template"](11,U,6,1,"div",25),o["\u0275\u0275elementEnd"](),o["\u0275\u0275template"](12,V,5,0,"mg-button",26),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit,r=t.index,n=o["\u0275\u0275nextContext"]();o["\u0275\u0275classProp"]("blockorder-highlight",n.isDisplayHighlighted(r)),o["\u0275\u0275advance"](3),o["\u0275\u0275textInterpolate2"](" ",e.record.prefix," ",e.record.blockorder," "),o["\u0275\u0275advance"](5),o["\u0275\u0275textInterpolate"](n.displayRecordDate(e.record)),o["\u0275\u0275advance"](3),o["\u0275\u0275property"]("ngForOf",e.errors),o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("ngIf",e.errors.length>0)}}function D(e,t){if(1&e&&(o["\u0275\u0275elementStart"](0,"div",31),o["\u0275\u0275elementStart"](1,"div",32),o["\u0275\u0275element"](2,"mg-success-checkmark"),o["\u0275\u0275elementStart"](3,"div",33),o["\u0275\u0275text"](4),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"]()),2&e){const e=o["\u0275\u0275nextContext"]();o["\u0275\u0275advance"](4),o["\u0275\u0275textInterpolate1"](" ",e.blockorderUploadRecords.length," records uploaded! ")}}const A={date:/date|time|when/gi,prefix:/prefix|before|text|/gi,blockorder:/blockorder|block|order|schedule|message|/gi};let j=(()=>{class e{constructor(e,t,r,o,n){this.mgModal=e,this.contentFeed=t,this.topOfFeed=r,this.routerDerivedState=o,this.mingaStore=n,this.files=[],this.errors=[],this.hasErrorsFromParse=!1,this.blockorderUploadRecords=[],this.displayBlockorderUploadRecords=[],this.uploading=!1,this.highlightIndex=-1,this.totalProgress=0,this.totalBufferProgress=0,this.defaultPageSize=10,this.groupHash=null,this.districtEnabled=!1,this._destroyed$=new a.a(1),this.routerDerivedState.currentGroup$.pipe(Object(i.a)(this._destroyed$)).subscribe(e=>{e&&e.hash&&(this.groupHash=e.hash)}),this.mingaStore.observeDistrictFeatureEnabled().pipe(Object(i.a)(this._destroyed$)).subscribe(e=>this.districtEnabled=e)}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}parseColumnName(e){let t=0,r="";for(const o in A){let n=e.match(A[o]);n&&(n=n.filter(e=>!!e),n.length>t&&(t=n.length,r=o))}return r}parseData(e){const t=e[0].map(e=>this.parseColumnName(e)),r=e.slice(1);for(let o=0;r.length>o;o++){const e=r[o],n={};t.forEach((t,r)=>{const o=e[r];o&&t&&(n[t]=o)});const s=[];if(s.length>0){this.hasErrorsFromParse=!0;let e="";e=1==s.length?s[0]:`Multiple (${s.length}) errors for record`,this.errors.push({recordIndex:this.blockorderUploadRecords.length,errorMessage:e})}this.blockorderUploadRecords.push({record:n,errors:s,progress:0,highlight:!1})}this.blockorderUploadRecords=this.blockorderUploadRecords.filter(e=>e.record.blockorder||e.record.prefix),this.onPageChange({pageIndex:0,pageSize:this.defaultPageSize})}displayRecordDate(e){return Object(n.day)(e.date).format("MMM Do YYYY")}clear(){this.displayBlockorderUploadRecords=[],this.blockorderUploadRecords=[],this.clearErrorsAndProgress()}clearErrorsAndProgress(){this.errors=[],this.totalBufferProgress=0,this.totalProgress=0,this.hasErrorsFromParse=!1,this.clearHighlights(),this.blockorderUploadRecords.forEach(e=>{e.errors=[],e.progress=0})}clearHighlights(){this.highlightIndex=-1}onPageChange(e){const t=e.pageIndex,r=e.pageSize;this.displayBlockorderUploadRecords=this.blockorderUploadRecords.slice(t*r,t*r+r)}isDisplayHighlighted(e){return!!this.paginator&&this.paginator.pageIndex*this.paginator.pageSize+e===this.highlightIndex}parseFile(e){const t=new FileReader;t.onloadend=e=>{const r=l.a(t.result,{type:"array"});if(r.Sheets)for(let t in r.Sheets){const e=l.b.sheet_to_json(r.Sheets[t],{header:1,blankrows:!1,raw:!1});this.parseData(e)}},t.readAsArrayBuffer(e)}filesChange(){for(let e of this.files)this.parseFile(e)}startUpload(){const e=new s.AddTopOfFeedTextRequest;this.districtEnabled&&this.groupHash&&e.setGrouphash(this.groupHash),this.errors=[],this.totalBufferProgress=0,this.totalProgress=0,this.clearErrorsAndProgress(),this.blockorderUploadRecords.forEach(t=>{const r=new s.TopOfFeedText;r.setPrefix(t.record.prefix||""),r.setText(t.record.blockorder||"");const o=n.day.utc(t.record.date).toDate();r.setTimestamp(o.getTime()),e.addTopOfFeedText(r)});const t=this.contentFeed.addTopOfFeedText(e);this.uploading=!0;let r=!1;t.subscribe(e=>{this.totalProgress=Math.max(this.totalProgress,100*e.getTotalProgress());const t=this.blockorderUploadRecords[e.getIndex()];if(t&&(t.progress=100*e.getProgress()),e.hasError()){r=!0;const t=e.getError(),o=t.getIndex();if(o>-1){const r=this.blockorderUploadRecords[o];r&&(r.errors.push(t.getMessage()),this.errors.push({recordIndex:e.getIndex(),errorMessage:t.getMessage()}))}else this.errors.push({recordIndex:-1,errorMessage:t.getMessage()})}},e=>{console.error(e),this.uploading=!1},()=>{if(!r){let e=this.mgModal.open(this.successOverlayTemplate,{full:!0,animation:"fade"});setTimeout(()=>{this.clear(),e.close()},2e3)}this.uploading=!1,this.topOfFeed.invalidateTopOfFeedCache()})}goToError(e){}removeRecord(e){}}return e.\u0275fac=function(t){return new(t||e)(o["\u0275\u0275directiveInject"](c.b),o["\u0275\u0275directiveInject"](d.ContentFeed),o["\u0275\u0275directiveInject"](p.a),o["\u0275\u0275directiveInject"](g.a),o["\u0275\u0275directiveInject"](h.b))},e.\u0275cmp=o["\u0275\u0275defineComponent"]({type:e,selectors:[["mg-admin-blockorder"]],viewQuery:function(e,t){if(1&e&&(o["\u0275\u0275viewQuery"](C,3),o["\u0275\u0275viewQuery"](F,3),o["\u0275\u0275viewQuery"](I,3)),2&e){let e;o["\u0275\u0275queryRefresh"](e=o["\u0275\u0275loadQuery"]())&&(t.form=e.first),o["\u0275\u0275queryRefresh"](e=o["\u0275\u0275loadQuery"]())&&(t.paginator=e.first),o["\u0275\u0275queryRefresh"](e=o["\u0275\u0275loadQuery"]())&&(t.successOverlayTemplate=e.first)}},decls:18,vars:7,consts:[[3,"component"],[1,"mg-centered"],[1,"hint-text"],["href","https://support.minga.io/knowledge/uploading-your-school-s-block-schedule-to-minga"],["name","bulkPeopleFileInput","multiple","","icon","list_file-o","compactIcon","list_file-o","accept",".csv, text/csv,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","friendlyName","CSV or Excel file",3,"ngModel","showFileDetails","ngModelChange"],["class","blockorder-records-list","fxLayout","row","fxLayoutAlign","center center","fxLayoutGap","8px",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"length","pageSize","pageSizeOptions","page",4,"ngIf"],[1,"blockorder-list"],["blockorderList",""],["class","blockorder-record-wrap",3,"blockorder-highlight",4,"ngFor","ngForOf"],["successOverlayTemplate",""],["fxLayout","row","fxLayoutAlign","center center","fxLayoutGap","8px",1,"blockorder-records-list"],[3,"disabled","click"],["class","clear-btn","type","outline",3,"click",4,"ngIf"],["fxFlex","","mode","buffer",1,"upload-progress",3,"ngStyle","value","bufferValue"],["type","outline",1,"clear-btn",3,"click"],["fxLayout","row","fxLayoutAlign","center center",1,"upload-error",3,"click"],["fxFlex",""],[3,"length","pageSize","pageSizeOptions","page"],["paginator",""],[1,"blockorder-record-wrap"],["fxLayout","column",1,"blockorder-record"],["fxLayout","row","fxFlex",""],["fxLayout","row","fxLayoutAlign","start top"],["class","blockorder-record-errors","ngClass.xs","no-margin",4,"ngFor","ngForOf"],["class","remove-record-btn","type","outline","fxLayout","row","fxLayoutAlign","center center",3,"click",4,"ngIf"],["ngClass.xs","no-margin",1,"blockorder-record-errors"],["fxLayout","row","fxLayoutAlign","center center",1,"upload-error"],["type","outline","fxLayout","row","fxLayoutAlign","center center",1,"remove-record-btn",3,"click"],[1,"vmid"],[1,"success-overlay"],[1,"checkmark-wrap"],[1,"mg-bodycopy"]],template:function(e,t){1&e&&(o["\u0275\u0275element"](0,"mg-legacy-overlay-nav",0),o["\u0275\u0275elementStart"](1,"h1",1),o["\u0275\u0275text"](2,"Daily Bulletin Upload"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](3,"p",2),o["\u0275\u0275text"](4," Upload a small message for each day, to be displayed at the top of the home feed. This is often used for daily block schedules. "),o["\u0275\u0275elementStart"](5,"a",3),o["\u0275\u0275text"](6," See the helpdocs"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275text"](7," for more info on the format to use.\n"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](8,"form"),o["\u0275\u0275elementStart"](9,"mg-file-input",4),o["\u0275\u0275listener"]("ngModelChange",(function(e){return t.files=e}))("ngModelChange",(function(){return t.filesChange()})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275template"](10,O,5,8,"div",5),o["\u0275\u0275template"](11,M,6,3,"div",6),o["\u0275\u0275template"](12,L,2,4,"mat-paginator",7),o["\u0275\u0275elementStart"](13,"div",8,9),o["\u0275\u0275template"](15,_,13,7,"div",10),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275template"](16,D,5,1,"ng-template",null,11,o["\u0275\u0275templateRefExtractor"])),2&e&&(o["\u0275\u0275property"]("component",t),o["\u0275\u0275advance"](9),o["\u0275\u0275property"]("ngModel",t.files)("showFileDetails",!1),o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("ngIf",t.blockorderUploadRecords.length>0),o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("ngForOf",t.errors),o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("ngIf",t.blockorderUploadRecords.length>0),o["\u0275\u0275advance"](3),o["\u0275\u0275property"]("ngForOf",t.displayBlockorderUploadRecords))},directives:[u.a,f.E,f.u,f.v,m.a,f.t,f.w,x.o,x.n,b.e,b.d,b.f,y.a,v.a,b.b,x.p,k.c,S.a,E.a,k.a,w.a],styles:[".blockorder-record[_ngcontent-%COMP%]{padding:8px;background-color:#fff;border-radius:6px;margin:8px 4px;box-shadow:0 0 4px rgba(0,0,0,.17)}.success-overlay[_ngcontent-%COMP%]{height:100%;text-align:center;position:relative}.success-overlay[_ngcontent-%COMP%]   .checkmark-wrap[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translateY(-50%) translateX(-50%)}.hint-text[_ngcontent-%COMP%]{width:90%;margin:auto}mat-paginator[_ngcontent-%COMP%]{margin:16px 0}.blockorder-list[_ngcontent-%COMP%], .blockorder-record[_ngcontent-%COMP%], .blockorder-records-list[_ngcontent-%COMP%]{padding:20px}"]}),e})()},LM9v:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var o=r("SVse"),n=r("8Y7J"),s=r("u9T3"),a=r("s7LF"),i=r("5QHs"),l=r("BTe0"),c=r("CO6v"),d=r("9F0b"),p=r("eJkR"),g=r("ls3q"),h=r("CL15");r("8Vb0");let u=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=n["\u0275\u0275defineInjector"]({imports:[[g.a,p.a,c.a,d.c,h.a,o.c,a.m,s.a,i.b,l.b]]}),e})()},sETV:function(e,t,r){"use strict";r.r(t),r.d(t,"AdminBlockOrderRoutesModule",(function(){return l}));var o=r("8Y7J"),n=r("iInd"),s=r("8Vb0"),a=r("LM9v");const i=[{path:"",component:s.a}];let l=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=o["\u0275\u0275defineInjector"]({imports:[[a.a,n.k.forChild(i)]]}),e})()}}]);
//# sourceMappingURL=default~minga-app-src-app-routes-admin-AdminRoutes-module~minga-app-src-app-routes-admin-PeopleAdmin~5f09ade6-es2015.js.map